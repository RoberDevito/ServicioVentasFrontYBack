<div class="container">

  <!-- NAVBAR -->
  <header class="navbar">
    <span class="direccion">Urquiza 769</span>
    <i class="bi bi-person" aria-label="Perfil"></i>
  </header>

  <!-- CONTENIDO -->
  <main class="contenido">

    <ng-container *ngIf="!isCheckout && !isFavorites">

      <!-- PROMOS -->
      <!-- <h3 class="promoTitle">Promos</h3>
      <div class="promo-list">
        <div class="promo-card" *ngFor="let p of promos">
          <img class="promo-img" [src]="p.image" alt="{{ p.name }}">
          <div class="promo-info">
            <div class="name">{{ p.name }}</div>
            <div class="desc">{{ p.description }}</div>
            <div class="prices">
              <span class="promo-price">${{ p.price }}</span>
              <span class="old-price" *ngIf="p.oldPrice">${{ p.oldPrice }}</span>
            </div>
          </div>
          <button class="promo-add" (click)="addPromo(p)"><i class="bi bi-plus-lg"></i> Agregar</button>
        </div>
      </div> -->

      <!-- MENÚ: Hamburguesas -->
      <h3 *ngIf="hambur.length > 0" class="categoriasTitle">Hamburguesas</h3>
      <div class="menu-list">
        <div class="menu-item" *ngFor="let b of hambur">
          <img [src]="b.imagenUrl">
          <div class="info">
            <div class="name">{{ b.nombre }}</div>

            <!-- Lista de ingredientes -->
            <div class="desc">
              <span *ngFor="let ing of b.listIngredientes; let last = last">
                {{ ing.nombre }}<span *ngIf="!last">, </span>
              </span>
            </div>

            <div class="price">${{ b.precio }}</div>
          </div>

          <!-- <button class="fav" [class.active]="isFav(b.id)" (click)="toggleFavorite(b.id)">
            <i class="bi" [ngClass]="isFav(b.id) ? 'bi-heart-fill' : 'bi-heart'"></i>
          </button> -->

          <div class="actions">
            <div class="qty-mini">
              <button (click)="descrementar(b)">-</button>
              <span>{{ b.cantidad }}</span>
              <button (click)="incrementar(b)">+</button>
            </div>
            <button class="btn ghost" (click)="openModal(b)">Personalizar</button>
            <button class="btn primary" (click)="agregarCarrito(b)">Pedir</button>
          </div>
        </div>
      </div>
    </ng-container>
  </main>
  
  <!-- FAB Carrito (icono redondo que abre modal) -->
  <div class="fab-cart-wrapper" *ngIf="!isCheckout">
   <div class="cart-total-pill" *ngIf="total > 0">Total: ${{ total }}</div>
    <button class="fab-cart" (click)="openCart()" aria-label="Carrito">
      <i class="bi bi-bag-fill"></i>
      <span class="cart-badge" *ngIf="itemCount > 0">{{ itemCount }}</span>
    </button>
  </div>
  
  <!-- FOOTER -->
  <footer class="footer">
    <i class="bi bi-house" aria-label="Inicio" (click)="irHome()"></i>
    <i class="bi bi-heart" aria-label="Favoritos" (click)="irFavoritos()"></i>
    <i class="bi bi-receipt" aria-label="Pedidos"></i>
    <i class="bi bi-person" aria-label="Perfil"></i>
  </footer>


  <!-- MODAL Personalización -->
  <div class="app-modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>
  <div class="app-modal" *ngIf="showModal">
    <div class="modal-header">
      <div class="m-title">{{ selected?.nombre }}</div>
      <button class="close" (click)="closeModal()">×</button>
    </div>
    <div class="modal-body">
      <img class="m-img" [src]="selected?.imagenUrl" alt="{{ selected?.nombre }}" />
      <div class="section">
        <div class="label">Quitar ingredientes</div>
        <ng-container *ngFor="let ing of selected?.listIngredientes">
          <label class="chip" *ngIf="ing.tipo === 0">
            <input type="checkbox"
                  [checked]="removed.has(ing.nombre)"
                  (change)="toggleRemove(ing.nombre)" />
            <span>Sin {{ ing.nombre }}</span>
          </label>
        </ng-container>
      </div>
      <div class="extras-list">
        <ng-container *ngFor="let ex of selected?.listIngredientes">
          <div class="extra-item" *ngIf="ex.tipo === 1">
            <span class="extra-name">{{ ex.nombre }} (+${{ ex.precio }})</span>
            <div class="qty">
              <button (click)="decExtra(ex)">-</button>
              <span>{{ ex.cantidad ?? 0 }}</span>
              <button (click)="incExtra(ex)">+</button>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="qty main-qty">
        <button (click)="restarCant()">-</button>
          <span>{{ quantity }}</span>
        <button (click)="sumarCant()">+</button>
      </div>
    </div>
    <div class="modal-footer">
      <div class="m-price">${{ currentPrice() * quantity }}</div>
      <button class="confirm" (click)="addToCart()">Agregar al carrito</button>
    </div>
  </div>

  <!-- MODAL Carrito -->
  <div class="app-modal-backdrop" *ngIf="showCart" (click)="cerrarCart()"></div>
  <div class="app-modal cart" *ngIf="showCart">
    <div class="modal-header">
      <div class="m-title">Tu carrito</div>
      <button class="close" (click)="cerrarCart()">×</button>
    </div>
    <div class="modal-body">
      <div *ngIf="cart.cartItems.length; else emptyCart">
        <div class="cart-row" *ngFor="let it of cart.cartItems; let i = index">
          <div class="cart-info">
            <div class="name">{{ it.nombre }}</div>
            <div class="opts" *ngIf="it.options && (it.options.removed?.length || it.options.added?.length)">
              <span *ngIf="it.options.removed?.length">Sin {{ it.options.removed.join(', ') }}</span>
              <span *ngIf="it.options.added?.length"> | Extra {{ it.options.added.join(', ') }}</span>
            </div>
          </div>
          <div class="cart-qty">
            <button (click)="decCart(i)">-</button>
            <span>{{ it.cantidad }}</span>
            <button (click)="incCart(i)">+</button>
          </div>
          <div class="cart-price">${{ it.precio * it.cantidad }}</div>
          <button class="cart-remove" (click)="removeCart(i)"><i class="bi bi-x"></i></button>
        </div>
      </div>
      <ng-template #emptyCart>
        <p>Tu carrito está vacío.</p>
      </ng-template>
    </div>
    <div class="modal-footer">
      <div class="m-price">Total: ${{ total }}</div>
      <button class="confirm"
       (click)="goCheckout()"
       [disabled]="cart.cartItems.length === 0">
        Continuar
      </button>
    </div>
  </div>
  
</div>
