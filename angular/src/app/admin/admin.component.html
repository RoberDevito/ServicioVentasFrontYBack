<!-- Botón menú hamburguesa -->
<button class="menu-btn" (click)="menuOpen = !menuOpen">☰</button>

<!-- Sidebar deslizante -->
<div class="sidebar" [class.open]="menuOpen">
  <button class="close-btn" (click)="menuOpen = false">×</button>
  <ul>
    <li>
      <a routerLink="/crear-hamburguesa"
         routerLinkActive="active"
         (click)="menuOpen=false">Crear Hamburguesa</a>
    </li>
    <li>
      <a (click)="menuOpen=false" routerLink="/verPedidos">Ver Pedidos</a>
    </li>
  </ul>
</div>

<div class="form-wrapper">
  <h2>Agregar Hamburguesa</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
    <div class="field">
      <label for="nombre">Nombre</label>
      <input id="nombre" type="text" formControlName="nombre" placeholder="Ej: Doble Queso" />
      <div class="error" *ngIf="f.nombre?.touched && f.nombre?.invalid">
        <span *ngIf="f.nombre?.errors?.['required']">El nombre es obligatorio.</span>
        <span *ngIf="f.nombre?.errors?.['minlength']">Minimo 3 caracteres.</span>
      </div>
    </div>

    <div class="field">
      <label for="precio">Precio</label>
      <input id="precio" type="number" step="0.01" formControlName="precio" placeholder="Ej: 9.99" />
      <div class="error" *ngIf="f.precio?.touched && f.precio?.invalid">
        <span *ngIf="f.precio?.errors?.['required']">El precio es obligatorio.</span>
        <span *ngIf="f.precio?.errors?.['min']">Debe ser mayor o igual a 0.</span>
      </div>
    </div>

    <div class="field">
      <label for="imagenUrl">Imagen (URL)</label>
      <input id="imagenUrl" type="url" formControlName="imagenUrl" placeholder="https://..." />
      <div class="error" *ngIf="f.imagenUrl?.touched && f.imagenUrl?.invalid">
        <span *ngIf="f.imagenUrl?.errors?.['pattern']">Debe comenzar con http(s)://</span>
      </div>
    </div>

    <div class="field ingredientes" formArrayName="listIngredientes">
      <label>Ingredientes</label>
      <div class="ingrediente" *ngFor="let ingrediente of ingredientes.controls; let i = index" [formGroupName]="i">
        <div class="inputs">
          <input type="text" placeholder="Nombre" formControlName="nombre" />
          <input type="number" min="1" placeholder="Cant." formControlName="cantidad" />
          <button type="button" (click)="removeIngrediente(i)" [disabled]="ingredientes.length === 1">Quitar</button>
        </div>
        <div class="error" *ngIf="ingrediente.get('nombre')?.touched && ingrediente.get('nombre')?.invalid">
          <span *ngIf="ingrediente.get('nombre')?.errors?.['required']">El nombre es obligatorio.</span>
          <span *ngIf="ingrediente.get('nombre')?.errors?.['minlength']">Minimo 2 caracteres.</span>
        </div>
        <div class="error" *ngIf="ingrediente.get('cantidad')?.touched && ingrediente.get('cantidad')?.invalid">
          <span *ngIf="ingrediente.get('cantidad')?.errors?.['required']">La cantidad es obligatoria.</span>
          <span *ngIf="ingrediente.get('cantidad')?.errors?.['min']">Debe ser 1 o mas.</span>
        </div>
      </div>
      <button type="button" class="add" (click)="addIngrediente()">Agregar ingrediente</button>
    </div>

    <div class="actions">
      <button type="submit" [disabled]="form.invalid">Guardar</button>
    </div>
  </form>

  <div class="preview" *ngIf="form.value.nombre || form.value.precio || form.value.descripcion || form.value.imagenUrl || hasIngredientes()">
    <h3>Vista previa</h3>
    <div class="card">
      <img *ngIf="form.value.imagenUrl" [src]="form.value.imagenUrl!" alt="preview" (error)="form.patchValue({ imagenUrl: '' })">
      <div class="info">
        <strong>{{ form.value.nombre || 'Sin nombre' }}</strong>
        <span class="price" *ngIf="form.value.precio">{{ form.value.precio }}</span>
        <p class="desc" *ngIf="form.value.descripcion">{{ form.value.descripcion }}</p>
        <ul class="ingredientes-list" *ngIf="hasIngredientes()">
          <ng-container *ngFor="let ing of ingredientesPreview">
            <li *ngIf="ing?.nombre">{{ ing?.cantidad }} x {{ ing?.nombre }}</li>
          </ng-container>
        </ul>
      </div>
    </div>
  </div>
</div>
