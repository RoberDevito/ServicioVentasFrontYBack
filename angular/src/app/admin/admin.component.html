<!-- Botón menú hamburguesa -->
<button class="menu-btn" (click)="menuOpen = !menuOpen">☰</button>

<!-- Sidebar deslizante -->
<div class="sidebar" [class.open]="menuOpen">
  <button class="close-btn" (click)="menuOpen = false">×</button>
  <ul>
    <li>
      <a routerLink="/crear-hamburguesa"
         routerLinkActive="active"
         (click)="menuOpen=false">Crear Hamburguesa</a>
    </li>
    <li>
      <a (click)="menuOpen=false" routerLink="/verPedidos">Ver Pedidos</a>
    </li>
  </ul>
</div>

<div class="form-wrapper">
  <h2>Agregar Hamburguesa</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
    <!-- Nombre -->
    <div class="field">
      <label for="nombre">Nombre</label>
      <input id="nombre" type="text" formControlName="nombre" placeholder="Ej: Hamburguesa Clásica" />
      <div class="error" *ngIf="f.nombre?.touched && f.nombre?.invalid">
        <span *ngIf="f.nombre?.errors?.['required']">El nombre es obligatorio.</span>
        <span *ngIf="f.nombre?.errors?.['minlength']">Mínimo 3 caracteres.</span>
      </div>
    </div>

    <div class="field">
      <label for="descripcion">Descripcion</label>
      <input id="descripcion" type="text" formControlName="descripcion" placeholder="Ej: Descripcion de hamburguesa" />
      <div class="error" *ngIf="f.descripcion?.touched && f.descripcion?.invalid">
        <span *ngIf="f.descripcion?.errors?.['required']">La descripcion es obligatoria.</span>
        <span *ngIf="f.descripcion?.errors?.['minlength']">Mínimo 3 caracteres.</span>
      </div>
    </div>

    <!-- Precio -->
    <div class="field">
      <label for="precio">Precio</label>
      <input id="precio" type="number" step="0.01" formControlName="precio" placeholder="Ej: 9.99" />
      <div class="error" *ngIf="f.precio?.touched && f.precio?.invalid">
        <span *ngIf="f.precio?.errors?.['required']">El precio es obligatorio.</span>
        <span *ngIf="f.precio?.errors?.['min']">Debe ser mayor o igual a 0.</span>
      </div>
    </div>

    <!-- Imagen -->
    <div class="field">
      <label for="imagenUrl">Imagen (URL)</label>
      <input id="imagenUrl" type="url" formControlName="imagenUrl" placeholder="https://..." />
      <div class="error" *ngIf="f.imagenUrl?.touched && f.imagenUrl?.invalid">
        <span *ngIf="f.imagenUrl?.errors?.['pattern']">Debe comenzar con http(s)://</span>
      </div>
    </div>

    <!-- Ingredientes -->
    <div class="field ingredientes" formArrayName="listIngredientes">
      <label>Ingredientes</label>

      <div class="ingrediente" *ngFor="let ingrediente of ingredientes.controls; let i = index" [formGroupName]="i">
        <div class="inputs">
          <!-- Nombre -->
          <input type="text" placeholder="Nombre" formControlName="nombre" />

          <!-- Cantidad (solo si el tipo es Cantidad) -->
          <input type="number" min="0" placeholder="Cant." formControlName="cantidad" *ngIf="ingrediente.get('tipo')?.value === 'Cantidad'" />

          <!-- Precio -->
          <input
            type="number"
            step="0.01"
            min="0"
            placeholder="Precio"
            formControlName="precio"
            *ngIf="ingrediente.get('tipo')?.value !== 'Fijo'"
          />

          <!-- Tipo -->
          <select formControlName="tipo">
            <option value="Fijo">Fijo (Agregar/Quitar)</option>
            <option value="Cantidad">Cantidad (Ej: Medallones)</option>
            <option value="Carne">Carne (Selección tipo medallón)</option>  
          </select>

          <!-- Botón quitar -->
          <button type="button" (click)="removeIngrediente(i)" [disabled]="ingredientes.length === 1">Quitar</button>
        </div>

        <!-- Errores -->
        <div class="error" *ngIf="ingrediente.get('nombre')?.touched && ingrediente.get('nombre')?.invalid">
          <span *ngIf="ingrediente.get('nombre')?.errors?.['required']">El nombre es obligatorio.</span>
          <span *ngIf="ingrediente.get('nombre')?.errors?.['minlength']">Mínimo 2 caracteres.</span>
        </div>
        <div class="error" *ngIf="ingrediente.get('cantidad')?.touched && ingrediente.get('cantidad')?.invalid && ingrediente.get('tipo')?.value === 'Cantidad'">
          <span *ngIf="ingrediente.get('cantidad')?.errors?.['required']">La cantidad es obligatoria.</span>
          <!-- <span *ngIf="ingrediente.get('cantidad')?.errors?.['min']">Debe ser 1 o más.</span> -->
        </div>
        <div class="error" *ngIf="ingrediente.get('precio')?.touched && ingrediente.get('precio')?.invalid">
          <span *ngIf="ingrediente.get('precio')?.errors?.['min']">El precio no puede ser negativo.</span>
        </div>
      </div>

      <button type="button" class="add" (click)="addIngrediente()">Agregar ingrediente</button>
    </div>

    <!-- Botón submit -->
    <div class="actions">
      <button type="submit" [disabled]="form.invalid">Guardar</button>
    </div>
  </form>

  <!-- Vista previa -->
  <div class="preview" *ngIf="form.value.nombre || form.value.precio || form.value.imagenUrl || hasIngredientes()">
    <h3>Vista previa</h3>
    <div class="card">
      <img *ngIf="form.value.imagenUrl" [src]="form.value.imagenUrl!" alt="preview" (error)="onImageError()">
      <div class="info">
        <strong>{{ form.value.nombre || 'Sin nombre' }}</strong>
        <span class="price" *ngIf="form.value.precio">{{ form.value.precio | currency:'ARS' }}</span>
        <ul class="ingredientes-list" *ngIf="hasIngredientes()">
          <ng-container *ngFor="let ing of ingredientesPreview">
            <li *ngIf="ing?.nombre">
              <span *ngIf="ing.tipo === 'Fijo'">✔ {{ ing.nombre }}</span>
              <span *ngIf="ing.tipo === 'Cantidad'">{{ ing?.cantidad }} x {{ ing.nombre }}</span>
              <span *ngIf="ing?.precio"> ({{ ing.precio | currency:'ARS' }})</span>
            </li>
          </ng-container>
        </ul>
      </div>
    </div>
  </div>
</div>
